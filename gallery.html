<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lightサーバー - ギャラリー</title>
  <link rel="stylesheet" href="assets/style.css" />
  <script src="assets/bgm.js" defer></script>
</head>

<body>
  <nav>
    <ul>
      <li><a href="index.html">トップ</a></li>
      <li><a href="status.html">ステータス</a></li>
      <li><a href="gallery.html">ギャラリー</a></li>
      <li><a href="submit.html">動画投稿</a></li>
      <li><a href="todo.html">イベント</a></li>
    </ul>
  </nav>

  <main>
    <h1>クリップ集</h1>
    <div id="video-gallery" class="gallery"></div>
    <button id="load-more">もっと見る</button>
  </main>

  <footer>
    <audio id="bgm" autoplay loop>
      <source src="assets/bgm.mp3" type="audio/mpeg">
    </audio>
    <div class="bgm-controls">
      <button id="mute-btn">ミュート</button>
    </div>
  </footer>

  <script>
    const sheetId = "1SDi3pbOoArC9znJoYF0tL2sBHZ9p7Hw9aRErFgGbRPo";
    const apiKey = "AIzaSyDxuR5ex2opZcvGCLb9zC4WjKRL7mD7SnQ";
    const range = "Videos!A2:A";
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;

    const videosPerPage = 5;
    let videosData = [];
    let nextPageToken = 0;

    fetch(url)
      .then(response => response.json())
      .then(data => {
        if (data.values) {
          videosData = data.values.map(row => row[0]);
          displayVideos(videosData.slice(0, videosPerPage));
          nextPageToken = videosPerPage;
        }
      });

    function displayVideos(videos) {
      const gallery = document.getElementById("video-gallery");
      videos.forEach(videoUrl => {
        const iframe = document.createElement("iframe");
        iframe.src = videoUrl;
        iframe.allowFullscreen = true;
        iframe.width = "560";
        iframe.height = "315";
        iframe.classList.add("video-frame");
        gallery.appendChild(iframe);
      });
    }

    document.getElementById("load-more").addEventListener("click", () => {
      const nextVideos = videosData.slice(nextPageToken, nextPageToken + videosPerPage);
      displayVideos(nextVideos);
      nextPageToken += videosPerPage;
    });
  </script>
</body>

</html>
